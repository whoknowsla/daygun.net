{% extends 'blog/dashboard/base.html' %}

{% block title %}{{ action }} Post{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/@tiptap/pm/dist/style.css">
<style>
.editor-wrapper {
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    overflow: hidden;
}
.editor-toolbar {
    background: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
    padding: 0.75rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}
.editor-toolbar button {
    padding: 0.5rem 0.75rem;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
}
.editor-toolbar button:hover {
    background: #f3f4f6;
}
.editor-toolbar button.is-active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
}
.ProseMirror {
    min-height: 400px;
    padding: 1rem;
    outline: none;
}
.ProseMirror:focus {
    outline: none;
}
.ProseMirror h1 { font-size: 2em; font-weight: bold; margin: 0.67em 0; }
.ProseMirror h2 { font-size: 1.5em; font-weight: bold; margin: 0.75em 0; }
.ProseMirror h3 { font-size: 1.17em; font-weight: bold; margin: 0.83em 0; }
.ProseMirror h4 { font-size: 1em; font-weight: bold; margin: 1.12em 0; }
.ProseMirror h5 { font-size: 0.83em; font-weight: bold; margin: 1.5em 0; }
.ProseMirror h6 { font-size: 0.75em; font-weight: bold; margin: 1.67em 0; }
.ProseMirror p { margin: 1em 0; }
.ProseMirror ul, .ProseMirror ol { padding-left: 2em; margin: 1em 0; }
.ProseMirror code { background: #f3f4f6; padding: 0.2em 0.4em; border-radius: 0.25rem; font-family: monospace; }
.ProseMirror pre { background: #1f2937; color: #f3f4f6; padding: 1em; border-radius: 0.5rem; overflow-x: auto; }
.ProseMirror pre code { background: transparent; padding: 0; }
.ProseMirror blockquote { border-left: 4px solid #d1d5db; padding-left: 1em; margin: 1em 0; color: #6b7280; }
.ProseMirror a { color: #3b82f6; text-decoration: underline; }
.ProseMirror strong { font-weight: bold; }
.ProseMirror em { font-style: italic; }
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900">{{ action }} Blog Post</h1>
    </div>

    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <div class="bg-white rounded-lg shadow p-6 space-y-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="{{ form.title_en.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Title (English) *
                    </label>
                    {{ form.title_en }}
                    {% if form.title_en.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.title_en.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <label for="{{ form.title_tr.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Title (Turkish) *
                    </label>
                    {{ form.title_tr }}
                    {% if form.title_tr.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.title_tr.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <div>
                <label for="{{ form.slug.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Slug (URL) *
                </label>
                {{ form.slug }}
                {% if form.slug.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.slug.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="{{ form.summary_en.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Summary (English)
                    </label>
                    {{ form.summary_en }}
                </div>
                
                <div>
                    <label for="{{ form.summary_tr.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Summary (Turkish)
                    </label>
                    {{ form.summary_tr }}
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Content</h3>
                <p class="text-sm text-gray-600 mb-4">
                    Use the editor below to write your post in markdown. Switch between languages using the tabs.
                    <br><strong>Keyboard shortcuts:</strong> Ctrl+Shift+1-6 for headings, Ctrl+B for bold, Ctrl+I for italic
                </p>
            </div>

            <div class="mb-6" role="tablist">
                <button type="button" id="tab-en" class="px-4 py-2 bg-blue-600 text-white rounded-t-lg" role="tab" aria-selected="true" aria-controls="panel-en">
                    English Content
                </button>
                <button type="button" id="tab-tr" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2" role="tab" aria-selected="false" aria-controls="panel-tr">
                    Turkish Content
                </button>
            </div>

            <div id="panel-en" role="tabpanel" aria-labelledby="tab-en">
                <label for="{{ form.content_en.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Content (English) *
                </label>
                <div class="editor-wrapper">
                    <div class="editor-toolbar" id="toolbar-en" role="toolbar" aria-label="Text formatting toolbar for English content"></div>
                    <div id="editor-en" aria-label="English content editor"></div>
                </div>
                {{ form.content_en }}
            </div>

            <div id="panel-tr" class="hidden" role="tabpanel" aria-labelledby="tab-tr">
                <label for="{{ form.content_tr.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Content (Turkish) *
                </label>
                <div class="editor-wrapper">
                    <div class="editor-toolbar" id="toolbar-tr" role="toolbar" aria-label="Text formatting toolbar for Turkish content"></div>
                    <div id="editor-tr" aria-label="Turkish content editor"></div>
                </div>
                {{ form.content_tr }}
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                {{ form.is_published }}
                <label for="{{ form.is_published.id_for_label }}" class="ml-2 text-sm font-medium text-gray-700">
                    Publish this post (subscribers will be notified)
                </label>
            </div>
        </div>

        <div class="flex justify-between items-center">
            <a href="{% url 'dashboard_post_list' %}" 
               class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                Cancel
            </a>
            <button type="submit" 
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                {{ action }} Post
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/@tiptap/core@2.1.13/dist/index.umd.js"></script>
<script src="https://unpkg.com/@tiptap/pm@2.1.13/dist/index.js"></script>
<script src="https://unpkg.com/@tiptap/starter-kit@2.1.13/dist/index.umd.js"></script>
<script src="/static/js/editor.js"></script>
{% endblock %}
